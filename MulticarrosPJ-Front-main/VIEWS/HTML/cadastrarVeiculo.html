<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cadastrar Ve√≠culo- Multicarros Admin</title>
    <link rel="stylesheet" href="../Css/cadastrar.css" />
  </head>
  <body>
    <body class="auth-bg">
    <a href="dashboard.html" class="btn-voltar-home" title="Voltar para Home">
      <i class="fas fa-arrow-left"></i> ‚¨Ö
    </a>
    <div class="card-cadastro">
      <h2 class="card-titulo">Cadastrar / Editar Ve√≠culo üöó</h2>
      <form data-endpoint="/api/veiculos">
        <div class="form-row">
          <div class="form-group">
            <label>Marca/Modelo</label>
            <input type="text" name="marcaModelo" required />
          </div>
          <div class="form-group">
            <label>Pre√ßo (R$)</label>
            <input type="number" name="preco" required />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Ano Fabrica√ß√£o</label>
            <input type="number" name="anoFabricacao" required />
            <br>
            <label>Ano Modelo</label>
            <input type="number" name="anoModelo" required />
          </div>
          
          <div class="form-group">
            <label>Categoria</label>
            <select name="categoria" required>
              <option value="">-- selecione --</option>
              <option>Sedan</option>
              <option>SUV</option>
              <option>Hatch</option>
              <option>Picape</option>
            </select>
          </div>
        </div>
      <div class="form-group">
            <label>Status</label>
              <select name="status" required>
              <option value="">-- selecione --</option>
              <option>Seminovo</option>
              <option>Novo</option>
            </select>
          </div>    
          <div class="form-group">
            <label>Esp√©cie</label>
              <select name="especie" required>
              <option value="">-- selecione --</option>
              <option>Autom√≥vel</option>
              <option>Motocicleta</option>
            </select>
          </div>    
          <div class="form-group">
            <label>C√¢mbio</label>
              <select name="cambio" required>
              <option value="">-- selecione --</option>
              <option>Autom√°tico</option>
              <option>Manual</option>
            </select>
          </div>    
          <div class="form-group">
            <label>Cor</label>
              <input type="text" name="cor" required />
          </div>
          <div class="form-group">
            <label>Placa</label>
              <input type="text" name="placa" required />
          </div>
          <div class="form-group">
            <label>Chassi</label>
              <input type="text" name="chassi" required />
          </div>
          <div class="form-group">
            <label>Renavam</label>
              <input type="text" name="renavam" required />
          </div>
        <div class="form-group">
          <label for="fotoInput">Foto</label>
          <input id="fotoInput" type="file" accept="image/*" capture="environment" />
          <div class="foto-preview" aria-hidden="true">
            <img id="fotoPreview" alt="Pr√©-visualiza√ß√£o da foto" />
          </div>
        </div>
        <div class="form-group">
          <label>Descri√ß√£o</label>
            <textarea name="descricao" rows="3"></textarea>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn primary">Salvar</button>
          <button type="button" class="btn ghost">Cancelar</button>
        </div>
      </form>
    </div>

    <script>
      (function () {
        const fotoInput = document.getElementById('fotoInput');
        const fotoPreview = document.getElementById('fotoPreview');
        const fotoLabel = document.querySelector('label[for="fotoInput"]');

        if (!fotoInput) return;

        // Ensure attributes are present (some browsers ignore HTML attr in older pages)
        fotoInput.setAttribute('accept', 'image/*');
        fotoInput.setAttribute('capture', 'environment');

        // When user selects or takes a photo, show preview and store base64 in a hidden field
        fotoInput.addEventListener('change', function (e) {
          const file = e.target.files && e.target.files[0];
          if (!file) return;

          // Create object URL for preview
          const url = URL.createObjectURL(file);
          fotoPreview.src = url;
          fotoPreview.style.display = 'block';
          fotoPreview.alt = 'Foto selecionada';
          if (fotoLabel) fotoLabel.textContent = 'Foto (pronto)';

          // Also store as data URL so it can be submitted with the form if desired
          const reader = new FileReader();
          reader.onload = function () {
            let hidden = document.getElementById('fotoData');
            if (!hidden) {
              hidden = document.createElement('input');
              hidden.type = 'hidden';
              hidden.name = 'fotoData';
              hidden.id = 'fotoData';
              document.querySelector('form').appendChild(hidden);
            }
            hidden.value = reader.result; // base64 data URL
          };
          reader.readAsDataURL(file);
        });

        // Clicking the label or preview opens the camera/file picker
        if (fotoLabel) {
          fotoLabel.style.cursor = 'pointer';
          fotoLabel.addEventListener('click', function () {
            fotoInput.click();
          });
        }
        if (fotoPreview) {
          fotoPreview.style.cursor = 'pointer';
          fotoPreview.addEventListener('click', function () {
            fotoInput.click();
          });
        }
      })();
    </script>
    
    <script>
      (function () {
        const form = document.querySelector('form[data-endpoint]');
        if (!form) return;

        form.addEventListener('submit', function (e) {
          e.preventDefault();
          const endpoint = form.getAttribute('data-endpoint') || '/api/veiculos';
          const fd = new FormData(form);
          const obj = {};
          for (const [k, v] of fd.entries()) obj[k] = v;

          fetch(endpoint, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(obj),
          })
            .then((res) => {
              if (!res.ok) throw new Error('Erro na requisi√ß√£o');
              return res.json().catch(() => ({}));
            })
            .then((data) => {
              console.log('Ve√≠culo salvo', data);
              alert('Cadastro de ve√≠culo enviado com sucesso.');
            })
            .catch((err) => {
              console.error(err);
              alert('Falha ao enviar cadastro de ve√≠culo. Veja console.');
            });
        });
      })();
    </script>
  </body>
</html>
