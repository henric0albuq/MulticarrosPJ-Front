<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Area do Cliente</title>
    <link rel="stylesheet" href="../Css/dashboardCliente.css" />
    <link rel="stylesheet" href="../Css/meusDados.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  </head>
  <body>
    <div id="sidebar" class="sidebar">
      <div class="logo">Painel do Cliente</div>
      <nav>
        <ul>
          <li class="menu-item" data-section="veiculos">
            <span>üöó</span> Meus Ve√≠culos
          </li>
          <li class="menu-item" data-section="dados">
            <span>üë§</span> Meus Dados
          </li>
          <li class="menu-item" data-section="financeiro">
            <span>üí≥</span> Financeiro
          </li>
        </ul>
      </nav>
      <div class="sidebar-footer">
        <span id="clienteNome"></span>
        <a href="../HTML/login.html" style="color: #fff">Sair</a>
      </div>
    </div>
    <div class="main-content">
      <!-- Meus Ve√≠culos -->
      <section id="veiculosSection">
        <h2>Meus Ve√≠culos</h2>
        <div id="meusVeiculosLista">
      <!-- Ve√≠culos ser√£o carregados aqui dinamicamente -->
        </div>
      </section>
      <!-- Meus Dados -->
      <section id="dadosSection" class="hide">
        <h2>Meus Dados</h2>
       
    <div class="card-dados">
      <div class="linha">
        <p><strong>Nome:</strong> <span id="nomeCliente"></span></p>
        <p><strong>Telefone:</strong> <span id="telefoneCliente"></span></p>
      </div>

      <div class="linha">
        <p><strong>Email:</strong> <span id="emailCliente"></span></p>
        <p><strong>CPF:</strong> <span id="cpfCliente"></span></p>
      </div>

      <div class="linha">
        <p><strong>Data de Nascimento:</strong> <span id="nascimentoCliente"></span></p>
        <p><strong>Senha:</strong> <span id="senhaCliente"></span></p>
      </div>

      <button id="btnEditar">‚úèÔ∏è Editar Dados</button>
    </div>

    <!-- CARD DE EDI√á√ÉO (POPUP) -->
    <div class="popup-editar" id="popupEditar">
      <div class="popup-conteudo">
        <h2>Editar Dados</h2>
        <label>Telefone</label>
        <input type="text" id="editTelefone" placeholder="(61) 99999-9999">

        <label>Email</label>
        <input type="email" id="editEmail" placeholder="exemplo@email.com">

        <label>Senha</label>
        <input type="password" id="editSenha" placeholder="Nova senha">

        <div class="botoes-popup">
          <button id="salvarEdicao">Salvar</button>
          <button id="fecharPopup">Cancelar</button>
        </div>
      </div>
    </div>
  </main>
      </section>
      <!-- Financeiro -->
      <section id="financeiroSection" class="hide">
        <h2>Financeiro</h2>
        <div id="boletosLista"></div>
      </section>
    </div>
      <!-- BOT√ÉO FIXO DE WHATSAPP -->
    <a href="https://wa.me/55619840002200" class="whatsapp-float" target="_blank">
    <i class="fa-brands fa-whatsapp"></i>
  </a>

    <!-- Modal e Toast -->
    <div id="modalBackdrop" style="display: none">
      <div id="modal" class="modal">
        <div class="modal-header">
          <span id="modalTitle"></span><button id="modalClose">√ó</button>
        </div>
        <div id="modalBody"></div>
        <div id="modalActions"></div>
      </div>
    </div>
    <div id="toast" class="toast"></div>
    <footer class="footer glass">
      <div class="footer-left">
        <img src="../Images/multilogo.png" class="footer-logo" />
      </div>
      <div class="muted">¬© 2025 </div>
    </footer>
    <script src="dashboardCliente.js"></script>
    <script>
  // Seleciona todos os itens do menu
  const menuItems = document.querySelectorAll('.menu-item');
  const sections = document.querySelectorAll('section');

  menuItems.forEach(item => {
    item.addEventListener('click', () => {
      // Remove classe ativa de todos
      menuItems.forEach(i => i.classList.remove('active'));

      // Adiciona classe ativa ao item clicado
      item.classList.add('active');

      // Esconde todas as se√ß√µes
      sections.forEach(sec => sec.classList.add('hide'));

      // Mostra a se√ß√£o correspondente
      const sectionToShow = document.getElementById(item.dataset.section + 'Section');
      if (sectionToShow) sectionToShow.classList.remove('hide');
    });
  });
</script>

<script>
const btnEditar = document.getElementById('btnEditar');
const popup = document.getElementById('popupEditar');
const fecharPopup = document.getElementById('fecharPopup');

if (btnEditar) {
  btnEditar.addEventListener('click', () => popup.style.display = 'flex');
}

if (fecharPopup) {
  fecharPopup.addEventListener('click', () => popup.style.display = 'none');
}

popup?.addEventListener('click', e => {
  if (e.target === popup) popup.style.display = 'none';
});
</script>

<script>
      (function () {
        const endpoint = document.body.dataset.apiClientes || "/api/clientes";
        const params = new URLSearchParams(window.location.search);
        const id = params.get("id");

        function escapeHtml(s) {
          return String(s || "");
        }

        async function fetchById(idToFetch) {
          const try1 =
            endpoint.replace(/\/$/, "") + "/" + encodeURIComponent(idToFetch);
          try {
            const res = await fetch(try1, { method: "GET" });
            if (!res.ok) throw new Error("status " + res.status);
            const json = await res.json();
            return Array.isArray(json) ? json[0] : json;
          } catch (e) {
            const try2 = endpoint + "?id=" + encodeURIComponent(idToFetch);
            const res2 = await fetch(try2, { method: "GET" });
            if (!res2.ok) throw new Error("status " + res2.status);
            const json2 = await res2.json();
            return Array.isArray(json2) ? json2[0] : json2;
          }
        }

        async function loadFirst() {
          const res = await fetch(endpoint, { method: "GET" });
          if (!res.ok) throw new Error("status " + res.status);
          const list = await res.json();
          if (Array.isArray(list) && list.length > 0) return list[0];
          return null;
        }

        function populate(cliente) {
          if (!cliente) return;
          const nome = cliente.nome || cliente.name || "";
          const telefone = cliente.telefone || cliente.phone || "";
          const email = cliente.email || cliente.mail || "";
          const cpf = cliente.cpf || "";
          const nascimento =
            cliente.nascimento ||
            cliente.dataNascimento ||
            cliente.data_nascimento ||
            "";

          const nomeEl = document.getElementById("nomeCliente");
          const telefoneEl = document.getElementById("telefoneCliente");
          const emailEl = document.getElementById("emailCliente");
          const cpfEl = document.getElementById("cpfCliente");
          const nascEl = document.getElementById("nascimentoCliente");
          const senhaEl = document.getElementById("senhaCliente");

          if (nomeEl) nomeEl.textContent = escapeHtml(nome);
          if (telefoneEl) telefoneEl.textContent = escapeHtml(telefone);
          if (emailEl) emailEl.textContent = escapeHtml(email);
          if (cpfEl) cpfEl.textContent = escapeHtml(cpf);
          if (nascEl) nascEl.textContent = escapeHtml(nascimento);
          if (senhaEl) senhaEl.textContent = "********";

          // preencher inputs de edi√ß√£o, se existirem
          const editTelefone = document.getElementById("editTelefone");
          const editEmail = document.getElementById("editEmail");
          const editSenha = document.getElementById("editSenha");
          if (editTelefone) editTelefone.value = telefone;
          if (editEmail) editEmail.value = email;
          if (editSenha) editSenha.value = "";
        }

        (async function () {
          try {
            let cliente = null;
            if (id) {
              cliente = await fetchById(id);
            } else {
              cliente = await loadFirst();
            }
            if (cliente) populate(cliente);
          } catch (err) {
            console.warn("N√£o foi poss√≠vel carregar dados do cliente:", err);
          }
        })();
      })();
    </script>

  </body>
</html>
